# Общее
## Имя валидатора
- произвольное.
Оно значимо только для снятия результата валидности:

<div v-if="!$v.myField.mustBeCool">Really!</div>

## Значение валидатора
- функция, возвращающая true/false или ПРОМИС(!), содержащий тоже true/false.
В аргумент автоматически подается валидируемое значение.


# Кастомный валидатор с ДОПОЛНИТЕЛЬНЫМ внешним ПАРАМЕТРОМ и несработкой при noDurty-состоянии.
import { helpers } from 'vuelidate/lib/validators'

const contains = param => value => !helpers.req(value) || value.indexOf(param) >= 0

validations: {
  myField: {
    mustBeCool: contains('cool')    //cool - это переменная, внешний параметр
  }
}


# Кастомный валидатор просто.
const isPhone = (v: string): boolean => {
  let re = /[(][0-9]{3}[)]\s[0-9]{3}[-][0-9]{2}[-][0-9]{2}/       //(999) 999-99-99
  re.lastIndex = 0
  return !helpers.req(v) || re.test(v)
}

validations: {
  forms: {
    login: {
      value: {
        isPhone
      }
    }
  }
},



# Хелперы.
## !helpers.req(value)
- это дает нам валидацию по условию required.
Однако null приравнивается к присутствию значения. ))
  
Применяется только в кастомных валидаторах,
в частности - для исключения срабатывания валидации, если <input> еще не заполнялся, (ставим в отрицании - !).

Если value - пустой, то helpers.req(value) возвращает false.

import { helpers } from "vuelidate/lib/validators";
const mustBeCool = value => !helpers.req(value) || value.includes("cool");  // "или" спотыкается на true.




# Асинхронные промисные валидаторы.
//https://vuelidate.js.org/#sub-asynchronous-validation

Функция валидатора может возвращать промис, а не только чистый boolean.
Пропускать результат сквозь .then() не требуется.
Если в resolve возвратится true - валидация будет положительной, false - отрицательной,
если reject - валидация будет отрицательной.

<input @blur="$v.username.$touch()" v-modal.lezy="age">    //.lezy- важно(!).
<div v-show="$v.username.$pending">louding...</div>
<div v-show="!$v.username.isUnique">не нашли</div>
  
validations: {
  username: {
    required,
    async isUnique(value) {
      if (value === '') return true    //если поле пустое, то проверку на сервере не запускаем. Проверять нечего.
      //или
      if(!helpers.req(value)) return true

      return Boolean(await fetch(`/api/unique/${value}`)        //<=
      //или
      return axios.get(`api/checkUser/${username}`)        //<=
      //или
      return new Promise((resolve, reject) => {       //<=
        setTimeout(() => {
          resolve(value.length % 2 !== 0)      // или можно написать reject(any) ==> false.
        }, 3000)
      })
//или
return new Promise((resolve, reject) => {
  aweit axios.get(`api/checkUser/${username}`)
    .then(response => resolve(response.ok))
    .catch(() => resolve(false))
})

    }
  }
}


validations: {
  async isUnique (value) {     //- применяется ко всем полям подряд??
    if (value === '') 
      return true

    const response = await fetch(`/api/unique/${value}`)
    return Boolean(await response.json())
  }
}

<div v-if="!$v.username.isUnique">Unique!</div>